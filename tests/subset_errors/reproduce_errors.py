import pytest
import tempfile
import msprime
from numpy.random import choice

def test_subset():
    with tempfile.NamedTemporaryFile(mode='w') as f:
        f.writelines(error_causing_file)
        f.flush()
        tr = msprime.load_txt(f.name)
    all_samples = tr.get_samples()
    print('total samples produced:', len(all_samples))
    # subset requires child of commit 21be37b in msprime
    with pytest.raises(Exception) as e_info:
        tr.subset(list(choice(all_samples, size=3, replace=False)))
    print("drawing 10 samples with subset causes")
    print(str(e_info))


error_causing_file = """left	right	node	children	time	population
0.690126	1.000000	16	0,1	0.000000	0
0.000000	0.690126	15	0,1	0.000000	0
0.244966	1.000000	8	0,2	0.000000	0
0.000000	0.244966	7	0,2	0.000000	0
0.280812	0.494669	28	12,16	0.500000	0
0.494669	1.000000	28	12,14,16	0.500000	0
0.166052	0.280812	28	0,12	0.500000	0
0.000000	0.166052	27	12,14,16	0.500000	0
0.166052	0.280812	27	14,16	0.500000	0
0.280812	0.494669	27	0,14	0.500000	0
0.000000	0.245273	26	8,10	0.500000	0
0.245273	0.629274	26	0,8	0.500000	0
0.629274	1.000000	25	8,10	0.500000	0
0.245273	0.629274	25	0,10	0.500000	0
0.000000	0.105372	24	3,5	0.500000	0
0.105372	0.397841	24	0,5	0.500000	0
0.397841	1.000000	23	3,5	0.500000	0
0.105372	0.397841	23	0,3	0.500000	0
0.000000	0.086988	22	4,6	0.500000	0
0.086988	0.534236	22	0,6	0.500000	0
0.534236	1.000000	21	4,6	0.500000	0
0.086988	0.534236	21	0,4	0.500000	0
0.000000	0.289003	20	11,13,15	0.500000	0
0.289003	0.445229	20	11,15	0.500000	0
0.445229	0.486477	20	0,11	0.500000	0
0.445229	0.486477	19	13,15	0.500000	0
0.486477	1.000000	19	11,13,15	0.500000	0
0.289003	0.445229	19	0,13	0.500000	0
0.214572	1.000000	32	7,9	0.500000	0
0.202059	0.214572	32	0,7	0.500000	0
0.000000	0.202059	31	7,9	0.500000	0
0.202059	0.214572	31	0,9	0.500000	0
0.000000	0.115878	46	18,20,22	1.000000	0
0.115878	0.397743	46	18,20	1.000000	0
0.397743	0.475430	46	0,20	1.000000	0
0.397743	0.475430	45	18,22	1.000000	0
0.475430	1.000000	45	18,20,22	1.000000	0
0.115878	0.397743	45	0,22	1.000000	0
0.000000	0.746958	44	17,19,21	1.000000	0
0.746958	0.753220	44	17,21	1.000000	0
0.753220	0.888258	44	0,21	1.000000	0
0.753220	0.888258	43	17,19	1.000000	0
0.888258	1.000000	43	17,19,21	1.000000	0
0.746958	0.753220	43	0,19	1.000000	0
0.000000	0.019253	40	24,26,28	1.000000	0
0.019253	0.553969	40	24,26	1.000000	0
0.553969	0.603567	40	0,26	1.000000	0
0.553969	0.603567	39	24,28	1.000000	0
0.603567	1.000000	39	24,26,28	1.000000	0
0.019253	0.553969	39	0,28	1.000000	0
0.590173	1.000000	38	30,32	1.000000	0
0.528549	0.590173	38	0,32	1.000000	0
0.000000	0.528549	37	30,32	1.000000	0
0.528549	0.590173	37	0,30	1.000000	0
0.000000	0.133154	36	23,25,27	1.000000	0
0.133154	0.802394	36	23,25	1.000000	0
0.802394	0.931816	36	0,23	1.000000	0
0.802394	0.931816	35	25,27	1.000000	0
0.931816	1.000000	35	23,25,27	1.000000	0
0.133154	0.802394	35	0,27	1.000000	0
0.528042	1.000000	34	29,31	1.000000	0
0.203660	0.528042	34	0,31	1.000000	0
0.000000	0.203660	33	29,31	1.000000	0
0.203660	0.528042	33	0,29	1.000000	0
0.143711	0.448333	61	35,37	1.500000	0
0.448333	1.000000	61	35,37,39	1.500000	0
0.079612	0.143711	61	0,35	1.500000	0
0.000000	0.125499	60	41,43	1.500000	0
0.125499	0.892115	60	0,43	1.500000	0
0.892115	1.000000	59	41,43	1.500000	0
0.125499	0.892115	59	0,41	1.500000	0
0.731186	1.000000	58	0,33	1.500000	0
0.000000	0.731186	57	0,33	1.500000	0
0.000000	0.207413	56	0,46	1.500000	0
0.207413	1.000000	55	0,46	1.500000	0
0.248787	1.000000	54	0,34	1.500000	0
0.000000	0.248787	53	0,34	1.500000	0
0.359513	0.461162	52	38,40	1.500000	0
0.461162	1.000000	52	36,38,40	1.500000	0
0.192326	0.359513	52	0,40	1.500000	0
0.000000	0.192326	51	36,38,40	1.500000	0
0.192326	0.359513	51	36,38	1.500000	0
0.359513	0.461162	51	0,36	1.500000	0
0.000000	0.073946	50	42,44	1.500000	0
0.073946	0.661872	50	0,42	1.500000	0
0.661872	1.000000	49	42,44	1.500000	0
0.073946	0.661872	49	0,44	1.500000	0
0.985901	1.000000	48	0,45	1.500000	0
0.000000	0.985901	47	0,45	1.500000	0
0.000000	0.079612	62	35,37,39	1.500000	0
0.079612	0.143711	62	37,39	1.500000	0
0.143711	0.448333	62	0,39	1.500000	0
0.062281	1.000000	92	0,48	2.000000	0
0.000000	0.062281	91	0,48	2.000000	0
0.000000	0.888176	88	0,49	2.000000	0
0.888176	1.000000	87	0,49	2.000000	0
0.000000	0.654026	86	60,62	2.000000	0
0.654026	0.888698	86	0,60	2.000000	0
0.888698	1.000000	85	60,62	2.000000	0
0.654026	0.888698	85	0,62	2.000000	0
0.296657	1.000000	84	0,50	2.000000	0
0.000000	0.296657	83	0,50	2.000000	0
0.912181	1.000000	78	0,58	2.000000	0
0.000000	0.912181	77	0,58	2.000000	0
0.211161	0.729941	76	52,56	2.000000	0
0.729941	1.000000	76	52,54,56	2.000000	0
0.081432	0.211161	76	0,52	2.000000	0
0.000000	0.081432	75	52,54,56	2.000000	0
0.081432	0.211161	75	54,56	2.000000	0
0.211161	0.729941	75	0,54	2.000000	0
0.132750	1.000000	74	0,47	2.000000	0
0.000000	0.132750	73	0,47	2.000000	0
0.000000	0.253049	68	0,57	2.000000	0
0.253049	1.000000	67	0,57	2.000000	0
0.000000	0.309377	66	51,53,55	2.000000	0
0.309377	0.403999	66	53,55	2.000000	0
0.403999	0.652236	66	0,53	2.000000	0
0.403999	0.652236	65	51,55	2.000000	0
0.652236	1.000000	65	51,53,55	2.000000	0
0.309377	0.403999	65	0,51	2.000000	0
0.000000	0.599859	64	59,61	2.000000	0
0.599859	0.632942	64	0,61	2.000000	0
0.632942	1.000000	63	59,61	2.000000	0
0.599859	0.632942	63	0,59	2.000000	0
"""

if __name__=="__main__":
    test_subset()


