name: Tests

on:
  pull_request:
  push:
    branches: [main, test]
  merge_group:

jobs:
  pre-commit:
    name: Lint
    uses: tskit-dev/.github/.github/workflows/lint.yml@v2

  test:
    uses: tskit-dev/.github/.github/workflows/python-tests.yml@v3
    strategy:
      matrix:
        python: [ "3.10", 3.13 ]
        os:  [ macos-latest, ubuntu-24.04, windows-latest ]
    with:
      additional_commands: |
        # Install GSL and fix Windows symlinks
        if [[ "${{ matrix.os }}" == "macos-latest" ]]; then
          brew install gsl
        elif [[ "${{ matrix.os }}" == "ubuntu-24.04" ]]; then
          sudo apt-get update && sudo apt-get install -y libgsl-dev
        elif [[ "${{ matrix.os }}" == "windows-latest" ]]; then
          rm lwt_interface
          cp -r --dereference git-submodules/tskit/python/lwt_interface ./lwt_interface
          vcpkg install gsl:x64-windows
        fi
      make_command: uv run --no-sync python setup.py build_ext --inplace
